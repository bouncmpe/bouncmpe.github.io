{{- $p := .Person -}}
{{- $page := .Page -}}

{{- $thumb := $p.thumbnail | default "images/person.png" -}}
{{- with resources.Get $thumb -}}
  {{- $thumb = (.Fill "240x240 webp q90 smart").RelPermalink -}}
{{- end -}}

{{- $scholar := or $p.google_scholar $p.scholar -}}
{{- $legacy  := or $page.Params.target $p.legacy_url -}}

<div class="card border-0 shadow-sm mx-auto p-4 p-md-5">

  <div class="d-flex flex-column flex-md-row gap-4">

    <div class="flex-shrink-0 mx-auto mx-md-0">
      <img src="{{ $thumb }}"
           class="img-fluid rounded shadow-sm"
           style="width: 240px; height: 240px; object-fit: cover;">
    </div>

    <div class="flex-grow-1 w-100">

      {{ with $p.short_bio }}
        <p class="mt-1 mb-3">{{ . }}</p>
      {{ end }}

      <div class="small text-muted mb-3">
        {{ with $p.email }}
          <div class="mb-1">
            <span class="fw-bold text-dark d-inline-block" style="width: 60px;">Email:</span> 
            <a href="mailto:{{ . }}">{{ . }}</a>
          </div>
        {{ end }}
        
        {{ with $p.office }}
          <div class="mb-1">
            <span class="fw-bold text-dark d-inline-block" style="width: 60px;">Office:</span> 
            {{ . }}
          </div>
        {{ end }}
        
        {{ with $p.phone }}
          <div class="mb-1">
            <span class="fw-bold text-dark d-inline-block" style="width: 60px;">Phone:</span> 
            {{ . }}
          </div>
        {{ end }}
        
        {{ with $p.homepage }}
          <div class="mb-1">
            <span class="fw-bold text-dark d-inline-block" style="width: 60px;">Web:</span> 
            <a href="{{ . }}">{{ . }}</a>
          </div>
        {{ end }}
      </div>

      <div class="d-flex flex-wrap gap-3 small align-items-center mb-3">
        {{ with $p.github }}   <a href="https://github.com/{{ . }}">GitHub</a>{{ end }}
        {{ with $p.linkedin }} <a href="https://www.linkedin.com/in/{{ . }}">LinkedIn</a>{{ end }}
        {{ with $scholar }}    <a href="{{ . }}">Scholar</a>{{ end }}
        {{ with $p.orcid }}    <a href="https://orcid.org/{{ . }}">ORCID</a>{{ end }}
        
        {{ with $legacy }}
          <div class="ms-md-auto">
             <a href="{{ . }}" class="btn btn-sm btn-outline-secondary py-0">Legacy page</a>
          </div>
        {{ end }}
      </div>

      {{ with $p.research_areas }}
        <div class="mt-2 small">
          <span class="fw-semibold me-2">Keywords:</span>
          {{ range . }}
            <span class="badge rounded-pill text-bg-light border me-1 mb-1">{{ . }}</span>
          {{ end }}
        </div>
      {{ end }}

    </div>
  </div>

  {{ if or $p.labs $p.courses $p.roles }}
    <hr class="my-4">
    <div class="row small">
      
      {{ with $p.labs }}
        <div class="col-12 col-md-4 mb-3">
          <span class="fw-bold d-block text-uppercase text-muted mb-1">Labs</span>
          <ul class="list-unstyled">
             {{ range . }}
               <li>{{ . }}</li>
             {{ end }}
          </ul>
        </div>
      {{ end }}

      {{ with $p.courses }}
        <div class="col-12 col-md-4 mb-3">
          <span class="fw-bold d-block text-uppercase text-muted mb-1">Courses</span>
          <span>
            {{ range $i, $c := . }}
              {{ if $i }}, {{ end }}{{ $c }}
            {{ end }}
          </span>
        </div>
      {{ end }}

      {{ with $p.roles }}
        <div class="col-12 col-md-4 mb-3">
          <span class="fw-bold d-block text-uppercase text-muted mb-1">Roles</span>
          <span>
            {{ if (reflect.IsSlice .) }}
              {{ range $i, $r := . }}
                {{ if $i }}, {{ end }}{{ $r }}
              {{ end }}
            {{ else }}
              {{ . }}
            {{ end }}
          </span>
        </div>
      {{ end }}

    </div>
  {{ end }}

</div>